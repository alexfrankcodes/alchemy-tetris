[gd_scene load_steps=7 format=2]

[ext_resource path="res://Art/Tiles/plant.png" type="Texture" id=1]
[ext_resource path="res://Art/Icons/Sound.png" type="Texture" id=3]
[ext_resource path="res://Art/Icons/NewGame.png" type="Texture" id=4]
[ext_resource path="res://Art/Icons/Pause.png" type="Texture" id=5]
[ext_resource path="res://Art/Icons/Music.png" type="Texture" id=6]

[sub_resource type="GDScript" id=1]
script/source = "extends CenterContainer

const GRID_SIZE = 100

var grid
var next

# Music/Sound
var music = 0
var sound = 0
var min_vol

# Level/Scoring
var level = 1 setget set_level
var score = 0 setget set_score
var high_score = 0 setget set_high_score
var lines = 0 setget set_lines

signal button_pressed(button_name)

###################### SETUP ######################
func _ready():
	grid = find_node(\"Grid\")
	next = find_node(\"NextBlock\")
	min_vol = find_node(\"Music\").get_min()
	find_node(\"Sound\").set_min(min_vol)
	generate_cells(grid, GRID_SIZE)
	clear_all_cells()

func generate_cells(node, n):
	var num_cells = node.get_child_count()
	while num_cells < n:
		node.add_child(node.get_child(0).duplicate())
		num_cells += 1

func clear_cells(node):
	for cell in node.get_children():
		cell.modulate = Color(0)

func clear_all_cells():
	clear_cells(grid)	
	clear_cells(next)

###################### GAME STATE ######################
func set_level(value):
	find_node(\"Level\").text = str(value)
	level = value

func set_score(value):
	find_node(\"Score\").text = str(value)
	score = value

func set_high_score(value):
	find_node(\"HighScore\").text = \"%08d\" % value
	high_score = value

func set_lines(value):
	find_node(\"Lines\").text = str(value)
	lines = value

func reset_stats(_high_score = 0, _score = 0, _lines = 0, _level = 1):
	self.high_score = _high_score
	self.score = _score
	self.lines = _lines
	self.level = _level

func settings(data):
	self.high_score = data.high_score
	find_node(\"Music\").value = data.music
	find_node(\"Sound\").value = data.sound

###################### BUTTON MUTATORS ######################
func set_button_state(button, state):
	find_node(button).set_disabled(state)
	
func set_button_text(button, text):
	find_node(button).set_text(text)

func set_button_states(playing):
	set_button_state(\"NewGame\", playing)
	set_button_state(\"About\", playing)
	set_button_state(\"Pause\", !playing)

# Preview Next shape:
func set_next_shape(shape: ShapeData):
	clear_cells(next)
	var i = 0
	for col in shape.coors.size():
		for row in [0, 1]:
			if shape.grid[row][col]:
				next.get_child(i).modulate = shape.color
			i += 1

###################### SIGNALS ######################
func _on_NewGame_button_down():
	emit_signal(\"button_pressed\", \"NewGame\")

func _on_About_button_down():
	$AboutBox.popup_centered()
	emit_signal(\"button_pressed\", \"About\")

func _on_Sound_pressed():
	emit_signal(\"button_pressed\", \"Sound\")

func _on_Music_pressed():
	music = true
	emit_signal(\"button_pressed\", \"Music\")

func _on_AboutBox_popup_hide():
	set_button_state(\"About\", false)

func _on_Pause_button_down():
	emit_signal(\"button_pressed\", \"Pause\")


"

[node name="GUI" type="CenterContainer"]
anchor_top = -0.00104872
anchor_right = 1.0
anchor_bottom = 0.998951
margin_top = -2.0
margin_bottom = -2.0
script = SubResource( 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="AboutBox" type="AcceptDialog" parent="."]
margin_left = 708.0
margin_top = 439.0
margin_right = 1150.0
margin_bottom = 531.0
window_title = "About Game"
dialog_text = "This is a game made for My First Game Jam 2020: Summer Edition.

Controls:"

[node name="HBoxContainer" type="HBoxContainer" parent="."]
margin_right = 1858.0
margin_bottom = 970.0
size_flags_horizontal = 0
size_flags_vertical = 0

[node name="Left" type="VBoxContainer" parent="HBoxContainer"]
margin_right = 640.0
margin_bottom = 970.0

[node name="GameSpace" type="HBoxContainer" parent="HBoxContainer/Left"]
margin_right = 640.0
margin_bottom = 64.0

[node name="MarginContainer" type="MarginContainer" parent="HBoxContainer/Left/GameSpace"]
margin_right = 640.0
margin_bottom = 64.0

[node name="Background" type="ColorRect" parent="HBoxContainer/Left/GameSpace/MarginContainer"]
margin_right = 640.0
margin_bottom = 64.0
rect_min_size = Vector2( 640, 0 )
color = Color( 0, 0, 0, 0.658824 )

[node name="Grid" type="GridContainer" parent="HBoxContainer/Left/GameSpace/MarginContainer"]
margin_right = 640.0
margin_bottom = 64.0
columns = 10

[node name="Cell" type="TextureRect" parent="HBoxContainer/Left/GameSpace/MarginContainer/Grid"]
margin_right = 64.0
margin_bottom = 64.0
texture = ExtResource( 1 )

[node name="Right" type="VBoxContainer" parent="HBoxContainer"]
margin_left = 644.0
margin_right = 1858.0
margin_bottom = 970.0
size_flags_horizontal = 0
size_flags_vertical = 0

[node name="CenterContainer" type="CenterContainer" parent="HBoxContainer/Right"]
margin_right = 1214.0
margin_bottom = 665.0
rect_min_size = Vector2( 200, 0 )
size_flags_horizontal = 3

[node name="VBoxContainer" type="VBoxContainer" parent="HBoxContainer/Right/CenterContainer"]
margin_left = 498.0
margin_right = 716.0
margin_bottom = 665.0
custom_constants/separation = 9

[node name="Stats" type="GridContainer" parent="HBoxContainer/Right/CenterContainer/VBoxContainer"]
margin_right = 218.0
margin_bottom = 540.0
custom_constants/vseparation = 10
custom_constants/hseparation = 20
columns = 2

[node name="NextBlock" type="GridContainer" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_right = 129.0
margin_bottom = 324.0
custom_constants/vseparation = 1
custom_constants/hseparation = 1
columns = 2

[node name="Cell" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_right = 64.0
margin_bottom = 64.0
texture = ExtResource( 1 )

[node name="Cell2" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_left = 65.0
margin_right = 129.0
margin_bottom = 64.0
texture = ExtResource( 1 )

[node name="Cell3" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_top = 65.0
margin_right = 64.0
margin_bottom = 129.0
texture = ExtResource( 1 )

[node name="Cell4" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_left = 65.0
margin_top = 65.0
margin_right = 129.0
margin_bottom = 129.0
texture = ExtResource( 1 )

[node name="Cell5" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_top = 130.0
margin_right = 64.0
margin_bottom = 194.0
texture = ExtResource( 1 )

[node name="Cell6" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_left = 65.0
margin_top = 130.0
margin_right = 129.0
margin_bottom = 194.0
texture = ExtResource( 1 )

[node name="Cell7" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_top = 195.0
margin_right = 64.0
margin_bottom = 259.0
texture = ExtResource( 1 )

[node name="Cell8" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_left = 65.0
margin_top = 195.0
margin_right = 129.0
margin_bottom = 259.0
texture = ExtResource( 1 )

[node name="Cell9" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_top = 260.0
margin_right = 64.0
margin_bottom = 324.0
texture = ExtResource( 1 )

[node name="Cell10" type="TextureRect" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats/NextBlock"]
margin_left = 65.0
margin_top = 260.0
margin_right = 129.0
margin_bottom = 324.0
texture = ExtResource( 1 )

[node name="_NextBlock" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 155.0
margin_right = 218.0
margin_bottom = 169.0
text = "Next Block"

[node name="_Level" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 334.0
margin_right = 129.0
margin_bottom = 348.0
text = "Level:"

[node name="Level" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 334.0
margin_right = 218.0
margin_bottom = 348.0
text = "1"

[node name="_Score" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 358.0
margin_right = 129.0
margin_bottom = 372.0
text = "Score:"

[node name="Score" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 358.0
margin_right = 218.0
margin_bottom = 372.0
text = "0"

[node name="_HighScore" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 382.0
margin_right = 129.0
margin_bottom = 396.0
text = "High Score:"

[node name="HighScore" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 382.0
margin_right = 218.0
margin_bottom = 396.0
text = "0"

[node name="_Lines" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 406.0
margin_right = 129.0
margin_bottom = 420.0
text = "Lines"

[node name="Lines" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 406.0
margin_right = 218.0
margin_bottom = 420.0
text = "0"

[node name="_MainProgress " type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 430.0
margin_right = 129.0
margin_bottom = 444.0
text = "Total:"

[node name="MainProgress" type="ProgressBar" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 430.0
margin_right = 218.0
margin_bottom = 444.0

[node name="_FireProgress" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 454.0
margin_right = 129.0
margin_bottom = 468.0
text = "Fire:"

[node name="FireProgress" type="ProgressBar" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 454.0
margin_right = 218.0
margin_bottom = 468.0

[node name="_WaterProgress" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 478.0
margin_right = 129.0
margin_bottom = 492.0
text = "Water"

[node name="WaterProgress" type="ProgressBar" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 478.0
margin_right = 218.0
margin_bottom = 492.0

[node name="_PlantProgress" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 502.0
margin_right = 129.0
margin_bottom = 516.0
text = "Plant:"

[node name="PlantProgress" type="ProgressBar" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 502.0
margin_right = 218.0
margin_bottom = 516.0

[node name="_LightningProgress" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_top = 526.0
margin_right = 129.0
margin_bottom = 540.0
text = "Lightning:"

[node name="LightningProgress" type="ProgressBar" parent="HBoxContainer/Right/CenterContainer/VBoxContainer/Stats"]
margin_left = 149.0
margin_top = 526.0
margin_right = 218.0
margin_bottom = 540.0

[node name="_Sound" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer"]
margin_top = 549.0
margin_right = 218.0
margin_bottom = 563.0
text = "Sound"

[node name="Sound" type="HSlider" parent="HBoxContainer/Right/CenterContainer/VBoxContainer"]
margin_top = 572.0
margin_right = 218.0
margin_bottom = 588.0

[node name="_Music" type="Label" parent="HBoxContainer/Right/CenterContainer/VBoxContainer"]
margin_top = 597.0
margin_right = 218.0
margin_bottom = 611.0
text = "Music"

[node name="Music" type="HSlider" parent="HBoxContainer/Right/CenterContainer/VBoxContainer"]
margin_top = 620.0
margin_right = 218.0
margin_bottom = 636.0

[node name="About" type="Button" parent="HBoxContainer/Right/CenterContainer/VBoxContainer"]
margin_top = 645.0
margin_right = 218.0
margin_bottom = 665.0
text = "About"

[node name="HBoxContainer2" type="HBoxContainer" parent="HBoxContainer/Right"]
margin_top = 669.0
margin_right = 1214.0
margin_bottom = 970.0
size_flags_horizontal = 0
size_flags_vertical = 0

[node name="NewGame" type="TextureButton" parent="HBoxContainer/Right/HBoxContainer2"]
margin_right = 300.0
margin_bottom = 301.0
size_flags_horizontal = 0
size_flags_vertical = 0
texture_normal = ExtResource( 4 )

[node name="Pause" type="TextureButton" parent="HBoxContainer/Right/HBoxContainer2"]
margin_left = 304.0
margin_right = 605.0
margin_bottom = 301.0
texture_normal = ExtResource( 5 )

[node name="Music" type="TextureButton" parent="HBoxContainer/Right/HBoxContainer2"]
margin_left = 609.0
margin_right = 909.0
margin_bottom = 301.0
texture_normal = ExtResource( 6 )

[node name="Sound" type="TextureButton" parent="HBoxContainer/Right/HBoxContainer2"]
margin_left = 913.0
margin_right = 1214.0
margin_bottom = 301.0
texture_normal = ExtResource( 3 )
[connection signal="popup_hide" from="AboutBox" to="." method="_on_AboutBox_popup_hide"]
[connection signal="button_down" from="HBoxContainer/Right/CenterContainer/VBoxContainer/About" to="." method="_on_About_button_down"]
[connection signal="button_down" from="HBoxContainer/Right/HBoxContainer2/NewGame" to="." method="_on_NewGame_button_down"]
[connection signal="ready" from="HBoxContainer/Right/HBoxContainer2/NewGame" to="." method="_on_NewGame_ready"]
[connection signal="button_down" from="HBoxContainer/Right/HBoxContainer2/Pause" to="." method="_on_Pause_button_down"]
